name: Deploy to GitHub Pages

on:
  schedule:
    - cron: '* * * * *'
  workflow_dispatch:

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Debug - Start workflow
      run: |
        echo "ðŸš€ Workflow started at $(date)"
        echo "ðŸ“‹ Event: ${{ github.event_name }}"
        
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Debug - Show file structure
      run: |
        echo "ðŸ“‚ Current directory structure:"
        pwd
        ls -la
        echo "ðŸ“„ Config file content:"
        cat config.toml || echo "No config.toml found"
        echo "ðŸ“ Themes directory:"
        ls -la themes/ || echo "No themes directory"
        
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: 'latest'
        extended: false
        
    - name: Validate Hugo configuration
      run: |
        echo "ðŸ”§ Testing Hugo configuration..."
        hugo config || echo "Hugo config test failed"
        
    - name: Generate new post
      run: |
        TIMESTAMP=$(date +%Y%m%d%H%M%S)
        echo "ðŸ•’ Generating post: helloworld$TIMESTAMP"
        mkdir -p content/posts
        echo "---" > content/posts/helloworld$TIMESTAMP.md
        echo "title: \"helloworld$TIMESTAMP\"" >> content/posts/helloworld$TIMESTAMP.md
        echo "date: $(date -u +"%Y-%m-%dT%H:%M:%SZ")" >> content/posts/helloworld$TIMESTAMP.md
        echo "draft: false" >> content/posts/helloworld$TIMESTAMP.md
        echo "---" >> content/posts/helloworld$TIMESTAMP.md
        echo "helloworld$TIMESTAMP" >> content/posts/helloworld$TIMESTAMP.md
        echo "âœ… Generated content:"
        cat content/posts/helloworld$TIMESTAMP.md
        
    - name: Build site
      run: |
        echo "ðŸ”¨ Building Hugo site..."
        hugo --minify 
        echo "ðŸ“Š Build summary:"
        echo "Public directory size:"
        du -sh public/ || echo "No public directory"
          # 7. éƒ¨ç½²åˆ° GitHub Pages
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        deploy_key: ${{ secrets.DEPLOY_KEY }}
        external_repository: jwj330/jwj330.github.io
        publish_dir: ./public
        publish_branch: main
        keep_files: false
          
 
